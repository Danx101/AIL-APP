<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Status Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h1>Appointment Status Testing</h1>
        
        <div class="row mt-4">
            <div class="col-12">
                <h3>Direct Status Badge Testing</h3>
                <p>This will test the exact functions from the app:</p>
                
                <div class="mb-3">
                    <label for="statusInput" class="form-label">Test Status:</label>
                    <input type="text" id="statusInput" class="form-control" value="bestÃ¤tigt" placeholder="Enter status to test">
                </div>
                
                <button class="btn btn-primary" onclick="testStatus()">Test Status Badge</button>
                <button class="btn btn-secondary ms-2" onclick="testAllStatuses()">Test All Statuses</button>
                
                <div id="testResults" class="mt-4"></div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-12">
                <h3>Fetch Real Appointment Data</h3>
                <p>Get actual appointment data from the API:</p>
                <button class="btn btn-info" onclick="fetchAppointmentData()">Fetch & Test Real Data</button>
                <div id="apiResults" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script>
        // Copy the exact functions from the app
        function getStatusBadgeClass(status) {
            console.log('ðŸŽ¨ getStatusBadgeClass called with status:', status, 'type:', typeof status);
            console.log('ðŸŽ¨ Status character codes:', status ? Array.from(status).map(char => char.charCodeAt(0)).join(',') : 'null');
            
            const classes = {
                'pending': 'bg-warning',
                'confirmed': 'bg-success',
                'cancelled': 'bg-danger',
                'completed': 'bg-info',
                'no_show': 'bg-secondary',
                'bestÃ¤tigt': 'bg-success',
                'abgesagt': 'bg-danger',
                'abgeschlossen': 'bg-info',
                'nicht erschienen': 'bg-secondary'
            };
            
            const result = classes[status] || 'bg-secondary';
            console.log('ðŸŽ¨ Status badge class for', status, 'â†’', result);
            
            if (status === 'bestÃ¤tigt') {
                console.log('ðŸŸ¢ BESTÃ„TIGT status detected!');
                alert('BESTÃ„TIGT status found! Result: ' + result);
            }
            
            return result;
        }

        function testStatus() {
            const status = document.getElementById('statusInput').value;
            const badgeClass = getStatusBadgeClass(status);
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = `
                <div class="alert alert-info">
                    <h5>Test Results for: "${status}"</h5>
                    <p><strong>Badge Class:</strong> ${badgeClass}</p>
                    <p><strong>Visual Result:</strong> <span class="badge ${badgeClass}">${status}</span></p>
                    <p><strong>Should be GREEN if "bestÃ¤tigt"</strong></p>
                </div>
            `;
        }

        function testAllStatuses() {
            const statuses = ['bestÃ¤tigt', 'confirmed', 'pending', 'abgeschlossen', 'abgesagt', 'completed', 'cancelled', 'no_show'];
            let html = '<div class="alert alert-secondary"><h5>All Status Tests:</h5>';
            
            statuses.forEach(status => {
                const badgeClass = getStatusBadgeClass(status);
                html += `<p><span class="badge ${badgeClass} me-2">${status}</span> â†’ ${badgeClass}</p>`;
            });
            
            html += '</div>';
            document.getElementById('testResults').innerHTML = html;
        }

        async function fetchAppointmentData() {
            try {
                const token = localStorage.getItem('authToken');
                if (!token) {
                    document.getElementById('apiResults').innerHTML = 
                        '<div class="alert alert-warning">No auth token found. Please login first in the main app.</div>';
                    return;
                }

                const response = await fetch('http://localhost:3001/api/v1/appointments/studio/1', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                console.log('ðŸ“‹ Fetched appointment data:', data);

                let html = '<div class="alert alert-success"><h5>Real Appointment Data:</h5>';
                
                if (data.appointments && data.appointments.length > 0) {
                    data.appointments.slice(0, 5).forEach(appointment => {
                        const badgeClass = getStatusBadgeClass(appointment.status);
                        html += `
                            <div class="mb-2">
                                <strong>ID ${appointment.id}:</strong> 
                                <span class="badge ${badgeClass}">${appointment.status}</span>
                                <small class="text-muted">(${appointment.appointment_date})</small>
                            </div>
                        `;
                    });
                } else {
                    html += '<p>No appointments found.</p>';
                }
                
                html += '</div>';
                document.getElementById('apiResults').innerHTML = html;

            } catch (error) {
                console.error('Error fetching appointments:', error);
                document.getElementById('apiResults').innerHTML = 
                    `<div class="alert alert-danger">Error: ${error.message}</div>`;
            }
        }

        // Auto-test on load
        window.addEventListener('load', () => {
            testStatus(); // Test "bestÃ¤tigt" by default
        });
    </script>
</body>
</html>