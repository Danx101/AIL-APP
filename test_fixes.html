<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fixes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>Test Trial Appointments Fixes</h1>
        
        <!-- Test 1: Status Badge Colors -->
        <div class="card mt-4">
            <div class="card-header">
                <h5>Test 1: Status Badge Colors</h5>
            </div>
            <div class="card-body">
                <p>Testing "nicht_erschienen" status badge color (should be orange):</p>
                <span class="badge bg-warning">Nicht erschienen</span> ✅ Orange (correct)
                <br><br>
                <p>Other status badges for comparison:</p>
                <span class="badge bg-primary">Bestätigt</span>
                <span class="badge bg-success">Absolviert</span>
                <span class="badge bg-secondary">Storniert</span>
            </div>
        </div>

        <!-- Test 2: Lead Details Modal -->
        <div class="card mt-4">
            <div class="card-header">
                <h5>Test 2: Lead Details Modal</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-primary" onclick="testLeadModal()">Test Lead Details Modal</button>
                <p class="mt-2 text-muted">This will test the standalone lead details modal functionality</p>
            </div>
        </div>

        <!-- Test 3: Reschedule Functionality -->
        <div class="card mt-4">
            <div class="card-header">
                <h5>Test 3: Reschedule Modal</h5>
            </div>
            <div class="card-body">
                <button class="btn btn-warning" onclick="testRescheduleModal()">Test Reschedule Modal (Trial)</button>
                <p class="mt-2 text-muted">This will test the reschedule modal with trial appointment data</p>
            </div>
        </div>
    </div>

    <script>
        // Mock window.API_BASE_URL for testing
        window.API_BASE_URL = 'http://localhost:3001';
        
        // Mock localStorage for testing
        localStorage.setItem('authToken', 'test-token');
        
        // Mock app object with necessary methods
        window.app = {
            formatPhone: function(phone) {
                if (!phone) return '';
                const cleaned = phone.replace(/\D/g, '');
                if (cleaned.startsWith('49')) {
                    return `+49 ${cleaned.slice(2, 5)} ${cleaned.slice(5)}`;
                }
                return phone;
            },
            
            getLeadStatusDisplay: function(status) {
                const statusMap = {
                    'new': 'Neu',
                    'working': 'In Bearbeitung',
                    'qualified': 'Qualifiziert',
                    'trial_scheduled': 'Probebehandlung geplant',
                    'converted': 'Konvertiert',
                    'unreachable': 'Nicht erreichbar',
                    'wrong_number': 'Falsche Nummer',
                    'not_interested': 'Nicht interessiert',
                    'lost': 'Verloren'
                };
                return statusMap[status] || status;
            },
            
            getLeadStatusBadgeClass: function(status) {
                const classMap = {
                    'new': 'bg-primary',
                    'working': 'bg-warning',
                    'qualified': 'bg-info',
                    'trial_scheduled': 'bg-purple text-white',
                    'converted': 'bg-success',
                    'unreachable': 'bg-brown',
                    'wrong_number': 'bg-danger',
                    'not_interested': 'bg-dark',
                    'lost': 'bg-muted'
                };
                return classMap[status] || 'bg-secondary';
            },

            createStandaloneLeadModal: function() {
                const modalHtml = `
                    <div class="modal fade" id="standaloneLeadModal" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">
                                        <i class="bi bi-person me-2"></i>
                                        Lead Details
                                    </h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="row g-3">
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Name</label>
                                            <div class="form-control-plaintext" id="standalone-lead-name">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Telefon</label>
                                            <div class="form-control-plaintext" id="standalone-lead-phone">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">E-Mail</label>
                                            <div class="form-control-plaintext" id="standalone-lead-email">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Quelle</label>
                                            <div class="form-control-plaintext" id="standalone-lead-source">-</div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Status</label>
                                            <div class="form-control-plaintext">
                                                <span class="badge" id="standalone-lead-status">-</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <label class="form-label fw-bold">Erstellt am</label>
                                            <div class="form-control-plaintext" id="standalone-lead-created">-</div>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label fw-bold">Notizen</label>
                                            <div class="form-control-plaintext" id="standalone-lead-notes" style="min-height: 60px; padding: 8px; background: #f8f9fa; border-radius: 4px;">-</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-primary">
                                        <i class="bi bi-kanban me-1"></i>
                                        Lead Management öffnen
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <style>
                        .bg-brown {
                            background-color: #8B4513 !important;
                            color: white !important;
                        }
                    </style>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHtml);
            },

            showLeadDetailsStandalone: async function(leadId) {
                // Create standalone lead details modal if it doesn't exist
                if (!document.getElementById('standaloneLeadModal')) {
                    this.createStandaloneLeadModal();
                }

                // Mock lead data for testing
                const lead = {
                    name: 'Test Lead',
                    phone_number: '+4915123456789',
                    email: 'test@example.com',
                    source: 'Website',
                    status: 'trial_scheduled',
                    created_at: new Date().toISOString(),
                    notes: 'Dies ist ein Test-Lead für die Überprüfung der Modal-Funktionalität.'
                };

                // Populate modal with lead data
                document.getElementById('standalone-lead-name').textContent = lead.name || '-';
                document.getElementById('standalone-lead-phone').textContent = this.formatPhone(lead.phone_number) || '-';
                document.getElementById('standalone-lead-email').textContent = lead.email || '-';
                document.getElementById('standalone-lead-source').textContent = lead.source || '-';
                document.getElementById('standalone-lead-created').textContent = new Date(lead.created_at).toLocaleDateString('de-DE');
                document.getElementById('standalone-lead-notes').textContent = lead.notes || 'Keine Notizen';
                
                // Status badge
                const statusBadge = document.getElementById('standalone-lead-status');
                statusBadge.textContent = this.getLeadStatusDisplay(lead.status);
                statusBadge.className = `badge ${this.getLeadStatusBadgeClass(lead.status)}`;
                
                // Show modal
                const modal = new bootstrap.Modal(document.getElementById('standaloneLeadModal'));
                modal.show();
            }
        };

        // Test functions
        function testLeadModal() {
            window.app.showLeadDetailsStandalone(123);
        }

        function testRescheduleModal() {
            // Mock reschedule modal for trial appointment
            const appointment = {
                id: 123,
                isTrialAppointment: true,
                lead_name: 'Test Lead',
                appointment_type_name: 'Probebehandlung',
                appointment_date: '2024-01-15',
                start_time: '10:00'
            };

            const modalHTML = `
                <div class="modal fade" id="testRescheduleModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header bg-warning text-dark">
                                <h5 class="modal-title">
                                    <i class="bi bi-calendar-alt me-2"></i>Termin umplanen
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <div class="alert alert-info">
                                    <strong>${appointment.isTrialAppointment ? 'Lead' : 'Kunde'}:</strong> ${
                                        appointment.isTrialAppointment 
                                            ? (appointment.lead_name || 'Unbekannt')
                                            : 'Customer Name'
                                    }<br>
                                    <strong>Behandlung:</strong> ${appointment.appointment_type_name || 'Behandlung'}
                                </div>
                                
                                <form>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">
                                                    <i class="bi bi-calendar me-2"></i>Neues Datum
                                                </label>
                                                <input type="date" class="form-control" value="${appointment.appointment_date}" required>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="mb-3">
                                                <label class="form-label">
                                                    <i class="bi bi-clock me-2"></i>Neue Startzeit
                                                </label>
                                                <input type="time" class="form-control" value="${appointment.start_time}" required>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">
                                            <i class="bi bi-sticky-note me-2"></i>Notiz zur Umplanung (optional)
                                        </label>
                                        <textarea class="form-control" rows="2" placeholder="Grund für die Umplanung..."></textarea>
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Abbrechen</button>
                                <button type="button" class="btn btn-warning">
                                    <i class="bi bi-save me-1"></i>Termin umplanen
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Remove existing modal if present
            const existingModal = document.getElementById('testRescheduleModal');
            if (existingModal) {
                existingModal.remove();
            }

            document.body.insertAdjacentHTML('beforeend', modalHTML);

            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('testRescheduleModal'));
            modal.show();

            // Clean up modal after hiding
            document.getElementById('testRescheduleModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }
    </script>
</body>
</html>