# API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - Abnehmen im Liegen

## –ë–∞–∑–æ–≤—ã–π URL
- –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞: `http://localhost:3001/api/v1`
- –ü—Ä–æ–¥–∞–∫—à–Ω: `https://your-domain.com/api/v1`

## –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
JWT —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ: `Authorization: Bearer <token>`

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Å—Ç—É–¥–∏–∏
**POST** `/auth/register-studio`
```json
{
  "email": "owner@studio.com",
  "password": "SecurePass123",
  "firstName": "–ú–∞–∫—Å",
  "lastName": "–ú—É—Å—Ç–µ—Ä–º–∞–Ω–Ω",
  "phone": "+49176123456",
  "studioName": "AiL –ë–µ—Ä–ª–∏–Ω –¶–µ–Ω—Ç—Ä",
  "studioAddress": "Hauptstra√üe 1, 10115",
  "studioCity": "Berlin",
  "studioPhone": "+493012345678"
}
```
**–û—Ç–≤–µ—Ç:** –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email

### –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ email
**GET** `/auth/verify-email/:token`
**–û—Ç–≤–µ—Ç:** JWT —Ç–æ–∫–µ–Ω + –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–∏–∏

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–ª–∏–µ–Ω—Ç–∞
**POST** `/auth/register-customer-enhanced`
```json
{
  "registrationCode": "BER-456",
  "email": "customer@email.com",
  "password": "password123",
  "sendVerificationEmail": true
}
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
**GET** `/auth/validate-code?code=BER-456`

### –í—Ö–æ–¥
**POST** `/auth/login`
```json
{
  "email": "user@email.com",
  "password": "password123"
}
```

---

## üìä –ö–∞–Ω–±–∞–Ω –ª–∏–¥–æ–≤

### –ü–æ–ª—É—á–∏—Ç—å –∫–∞–Ω–±–∞–Ω
**GET** `/kanban?studio_id=1`
**–û—Ç–≤–µ—Ç:** –õ–∏–¥—ã –ø–æ —Å—Ç–∞—Ç—É—Å–∞–º (new, working, qualified, trial_scheduled, converted, lost)

### –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –ª–∏–¥–∞
**PUT** `/leads/:id/move`
```json
{
  "to_status": "trial_scheduled",
  "appointment_data": {
    "date": "2025-01-15",
    "time": "14:00",
    "end_time": "15:00"
  }
}
```

### –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–ª–∏–µ–Ω—Ç–∞
**POST** `/leads/:id/convert`
```json
{
  "sessionPackage": 20,
  "paymentMethod": "cash",
  "notes": "–ü–æ—Å–ª–µ –ø—Ä–æ–±–Ω–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"
}
```
**–í–∞–∂–Ω–æ:** –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–∫—É–ø–∫–∞ –ø–∞–∫–µ—Ç–∞ —Å–µ—Å—Å–∏–π!

### –†–µ–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ª–∏–¥–∞
**POST** `/leads/:id/reactivate`
```json
{
  "target_status": "working"
}
```

### –ò—Å—Ç–æ—Ä–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
**GET** `/leads/:id/activities?limit=50`

### –î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É
**POST** `/leads/:id/notes`
```json
{
  "note": "–ò–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç—Å—è –ø–∞–∫–µ—Ç–æ–º –Ω–∞ 20 —Å–µ—Å—Å–∏–π"
}
```

### –ó–∞–ø–∏—Å–∞—Ç—å –∫–æ–Ω—Ç–∞–∫—Ç
**POST** `/leads/:id/contact`
```json
{
  "contact_type": "call"
}
```

---

## üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞–º–∏

### –°–æ–∑–¥–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ (—Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ —Å–µ—Å—Å–∏—è–º–∏)
**POST** `/studios/:studioId/customers`
```json
{
  "firstName": "–ê–Ω–Ω–∞",
  "lastName": "–®–º–∏–¥—Ç",
  "phone": "+49176987654",
  "email": "anna@example.com",
  "sessionPackage": 20,
  "paymentMethod": "cash",
  "notes": "–ü—Ä–µ–¥–ø–æ—á–∏—Ç–∞–µ—Ç —É—Ç—Ä–æ"
}
```
**–û—Ç–≤–µ—Ç:** –ö–æ–¥ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ (BER-789)

### –î–æ–±–∞–≤–∏—Ç—å —Å–µ—Å—Å–∏–∏
**POST** `/customers/:id/sessions`
```json
{
  "total_sessions": 20,
  "payment_method": "card",
  "notes": "–î–æ–∫—É–ø–∫–∞ 20 —Å–µ—Å—Å–∏–π"
}
```

### –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
**GET** `/customers/:id/registration-info`

### –°–ø–∏—Å–æ–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å—Ç—É–¥–∏–∏
**GET** `/studios/:studioId/customers?page=1&limit=20&search=anna`

### –î–µ—Ç–∞–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞
**GET** `/customers/:id`

### –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
**PUT** `/customers/:id`
```json
{
  "contact_first_name": "–ê–Ω–Ω–∞",
  "contact_last_name": "–®–º–∏–¥—Ç-–ú–∞–π–µ—Ä",
  "contact_phone": "+49176987655",
  "contact_email": "anna.new@example.com"
}
```

---

## üîç –ü–æ–∏—Å–∫

### –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫ (–ª–∏–¥—ã + –∫–ª–∏–µ–Ω—Ç—ã)
**GET** `/search/persons?type=all&query=max&studio_id=1`
- `type`: all, lead, customer
- `query`: –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞

### –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ (–¥–ª—è –∑–∞–ø–∏—Å–∏)
**GET** `/search/quick?query=anna&studio_id=1`

---

## üìÖ –ó–∞–ø–∏—Å–∏ –Ω–∞ –ø—Ä–∏–µ–º

### –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å
**POST** `/appointments`

**–î–ª—è –ª–∏–¥–∞ (—Ç–æ–ª—å–∫–æ –ø—Ä–æ–±–Ω–∞—è):**
```json
{
  "studio_id": 1,
  "person_type": "lead",
  "lead_id": 123,
  "appointment_type_id": 3,
  "appointment_date": "2025-01-15",
  "start_time": "14:00",
  "end_time": "15:00"
}
```

**–î–ª—è –∫–ª–∏–µ–Ω—Ç–∞:**
```json
{
  "studio_id": 1,
  "person_type": "customer",
  "customer_id": 456,
  "appointment_type_id": 1,
  "appointment_date": "2025-01-15",
  "start_time": "14:00",
  "end_time": "15:00"
}
```

### –ü–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å–∏ —Å—Ç—É–¥–∏–∏
**GET** `/appointments?studio_id=1&date=2025-01-15`

### –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–ø–∏—Å–∏
**PUT** `/appointments/:id/status`
```json
{
  "status": "completed"
}
```

### –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å
**DELETE** `/appointments/:id`

---

## üì¶ –ü–∞–∫–µ—Ç—ã —Å–µ—Å—Å–∏–π

### –¢–∏–ø—ã –ø–∞–∫–µ—Ç–æ–≤
- 10 —Å–µ—Å—Å–∏–π
- 20 —Å–µ—Å—Å–∏–π
- 30 —Å–µ—Å—Å–∏–π
- 40 —Å–µ—Å—Å–∏–π

### –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –∫–ª–∏–µ–Ω—Ç–∞
**GET** `/customers/:id/blocks`

### –ò—Å—Ç–æ—Ä–∏—è –ø–∞–∫–µ—Ç–æ–≤
**GET** `/customers/:id/session-history`

---

## üè¢ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—É–¥–∏—è–º–∏

### –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Å—Ç—É–¥–∏–∏
**GET** `/studios/:id`

### –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç—É–¥–∏—é
**PUT** `/studios/:id`
```json
{
  "name": "–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ",
  "address": "–ù–æ–≤—ã–π –∞–¥—Ä–µ—Å",
  "phone": "+49301234567"
}
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç—É–¥–∏–∏
**GET** `/studios/:id/stats`
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–∏–¥–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø–∏—Å–∏

---

## ‚ùå –ö–æ–¥—ã –æ—à–∏–±–æ–∫

### 400 Bad Request
```json
{
  "message": "–û—à–∏–±–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏",
  "errors": [
    {
      "field": "email",
      "message": "–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç email"
    }
  ]
}
```

### 401 Unauthorized
```json
{
  "message": "–¢–æ–∫–µ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∏–ª–∏ –∏—Å—Ç–µ–∫"
}
```

### 403 Forbidden
```json
{
  "message": "–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ—Å—É—Ä—Å—É"
}
```

### 404 Not Found
```json
{
  "message": "–†–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω"
}
```

### 500 Internal Server Error
```json
{
  "message": "–í–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞"
}
```

---

## üîÑ –ü–µ—Ä–µ—Ö–æ–¥—ã —Å—Ç–∞—Ç—É—Å–æ–≤ –ª–∏–¥–æ–≤

**–†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã:**
- `new` ‚Üí `working`, `unreachable`, `wrong_number`
- `working` ‚Üí `qualified`, `not_interested`, `unreachable`
- `qualified` ‚Üí `trial_scheduled`, `not_interested`
- `trial_scheduled` ‚Üí `converted`, `lost`

**–ê—Ä—Ö–∏–≤–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:**
- –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–µ: `converted`
- –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ: `unreachable`, `wrong_number`, `not_interested`, `lost`

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –∏ –æ—Ç—á–µ—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–∞–Ω–±–∞–Ω–∞
**GET** `/kanban/metrics?studio_id=1`
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –∫–æ–Ω–≤–µ—Ä—Å–∏–∏
- –ê–∫—Ç–∏–≤–Ω—ã–µ/–∞—Ä—Ö–∏–≤–Ω—ã–µ –ª–∏–¥—ã
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö

### –û—Ç—á–µ—Ç –ø–æ –∫–ª–∏–µ–Ω—Ç–∞–º
**GET** `/reports/customers?studio_id=1&from=2025-01-01&to=2025-01-31`

---

## üîë –í–∞–∂–Ω—ã–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏—è

1. **–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Å—Å–∏–∏**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ –í–°–ï–ì–î–ê —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–∞–∫–µ—Ç —Å–µ—Å—Å–∏–π
2. **–ö–æ–¥—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏**: –ì–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ (—Ñ–æ—Ä–º–∞—Ç: XXX-YYY)
3. **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç—É–¥–∏–π**: –ü—Ä–∏—Å–≤–∞–∏–≤–∞—é—Ç—Å—è –ø–æ –≥–æ—Ä–æ–¥—É (BER, MUC, HAM –∏ —Ç.–¥.)
4. **–ü—Ä–æ–±–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏**: –¢–æ–ª—å–∫–æ –¥–ª—è –ª–∏–¥–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º trial_scheduled
5. **Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–≤ —Å—Ç—É–¥–∏–π, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

---

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –°–æ–∑–¥–∞—Ç—å —Å—Ç—É–¥–∏—é –∏ –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
```bash
# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
curl -X POST http://localhost:3001/api/v1/auth/register-studio \
  -H "Content-Type: application/json" \
  -d '{"email":"test@studio.com", "password":"Test123", ...}'

# –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email ‚Üí –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω
```

### 2. –°–æ–∑–¥–∞—Ç—å –ª–∏–¥–∞
```bash
curl -X POST http://localhost:3001/api/v1/leads \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"name":"–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤", "phone":"+49176123456"}'
```

### 3. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–ª–∏–µ–Ω—Ç–∞
```bash
curl -X POST http://localhost:3001/api/v1/leads/1/convert \
  -H "Authorization: Bearer TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"sessionPackage":20, "paymentMethod":"cash"}'
```

---

## üìù –õ–∏–º–∏—Ç—ã

- –ó–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É: 100 –Ω–∞ IP
- –†–∞–∑–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞: –º–∞–∫—Å. 10MB
- –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: –º–∞–∫—Å. 30 —Å–µ–∫

---

*–í–µ—Ä—Å–∏—è: 1.0.0*
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 2025-01-13*